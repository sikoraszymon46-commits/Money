<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>Wypaty</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{margin:0;font-family:Arial;background:#0f2027;color:#fff}
header{background:#203a43;padding:20px;display:flex;justify-content:space-between;align-items:center}
a{color:#00e676;text-decoration:none;font-weight:bold}
main{max-width:1000px;margin:auto;padding:20px}
table{width:100%;border-collapse:collapse;margin-top:20px}
th,td{border:1px solid #00e676;padding:10px;text-align:center}
th{background:#1c2e35}
button{padding:5px 10px;border:none;border-radius:5px;cursor:pointer;font-weight:bold}
.green{background:#00e676;color:#000}
.red{background:#ff5252;color:#fff}
</style>
</head>
<body>

<header>
  <h2> Panel Wypat</h2>
  <a href="index.html"> Powr贸t do gier</a>
</header>

<main>
<h3>Twoje saldo: <span id="points">0</span> pkt</h3>

<div>
  <input type="text" id="email" placeholder="Email PayPal">
  <input type="text" id="name" placeholder="Imi i nazwisko">
  <input type="number" id="amount" placeholder="Ilo punkt贸w do wypaty">
  <button class="green" onclick="createWithdrawal()">Z贸偶 wniosek</button>
</div>

<table>
  <thead>
    <tr>
      <th>Imi i nazwisko</th>
      <th>Email PayPal</th>
      <th>Punkty</th>
      <th>Kwota (z)</th>
      <th>Data</th>
      <th>Status</th>
      <th>Akcja</th>
    </tr>
  </thead>
  <tbody id="withdrawals"></tbody>
</table>
</main>

<script>
let points = Number(localStorage.getItem("points")) || 0;
updateBalance();

let withdrawals = JSON.parse(localStorage.getItem("withdrawals")) || [];

function saveWithdrawals(){
  localStorage.setItem("withdrawals", JSON.stringify(withdrawals));
}

function updateBalance(){
  document.getElementById("points").innerText = points;
}

// Dodaj wniosek
function createWithdrawal(){
  let name = document.getElementById("name").value;
  let email = document.getElementById("email").value;
  let pts = Number(document.getElementById("amount").value);

  if(!name || !email || !pts){
    alert("Wypenij wszystkie pola");
    return;
  }
  if(pts > points){
    alert("Nie masz tylu punkt贸w");
    return;
  }
  let kwota = pts / 10000000; // 10 mln pkt = 1 z
  if(kwota < 30){
    alert("Minimalna wypata to 30 z");
    return;
  }

  let wniosek = {
    name: name,
    email: email,
    points: pts,
    kwota: kwota.toFixed(2),
    date: new Date().toLocaleString(),
    status: "Oczekuje"
  };
  withdrawals.push(wniosek);
  saveWithdrawals();
  renderWithdrawals();
  alert("Wniosek dodany!");
}

// Render tabeli
function renderWithdrawals(){
  let tbody = document.getElementById("withdrawals");
  tbody.innerHTML = "";
  withdrawals.forEach((w,index)=>{
    let tr = document.createElement("tr");

    tr.innerHTML = `
      <td>${w.name}</td>
      <td>${w.email}</td>
      <td>${w.points}</td>
      <td>${w.kwota}</td>
      <td>${w.date}</td>
      <td id="status-${index}">${w.status}</td>
      <td>
        ${w.status=="Oczekuje"?`
        <button class="green" onclick="approve(${index})">Zatwierd藕</button>
        <button class="red" onclick="reject(${index})">Odrzu</button>`:""}
      </td>
    `;
    tbody.appendChild(tr);
  });
}

// Zatwierd藕 wniosek
function approve(index){
  let w = withdrawals[index];
  points -= w.points; // odejmij punkty od salda
  if(points<0) points=0;
  w.status = "Zatwierdzona";
  localStorage.setItem("points", points);
  saveWithdrawals();
  updateBalance();
  renderWithdrawals();
}

// Odrzu wniosek
function reject(index){
  withdrawals[index].status = "Odrzucona";
  saveWithdrawals();
  renderWithdrawals();
}

renderWithdrawals();
</script>

</body>
</html>
